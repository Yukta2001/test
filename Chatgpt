import paramiko
import time

host = "10.9.39.217"
username = "oracle"
password = "oracle#123"

client = paramiko.client.SSHClient()
client.set_missing_host_key_policy(paramiko.AutoAddPolicy())
client.connect(host, username=username, password=password)
shell = client.invoke_shell()

def link_cmd(cmd,wait=1):
    shell.send(cmd + '\n')
    time.sleep(wait)
    while shell.recv_ready():
        output = shell.recv(1024).decode('utf-8')
        return output


env = link_cmd('. oraenv')
print(env)
sid = link_cmd('pysrrtdb')
print(sid)
path = link_cmd('cd /home/oracle/scripts/logs/')
print(path)
#jobfind = link_cmd('ls -ltrh jobmviews*')
#print(jobfind)
job = str(link_cmd('ls jobmviews* | tail -n 1'))
x = job.replace("ls jobmviews* | tail -n 1","").strip()
# print(f"grep -C 4 'ERROR' {x}")
err = link_cmd(f"grep -C 4 'ERROR' {x}")
print(err)
client.close()
